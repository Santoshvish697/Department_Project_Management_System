CREATE TABLE USERS (
Email VARCHAR(100) PRIMARY KEY,
PASSWORD VARCHAR(50) NOT NULL UNIQUE
);

CREATE TABLE STUDENT (
USN VARCHAR(25) PRIMARY KEY,
First_Name VARCHAR(25),
Middle_Name VARCHAR(25),
Last_Name VARCHAR(25),
Email VARCHAR(50) NOT NULL UNIQUE,
Phone_no VARCHAR(15),
FOREIGN KEY (Email) REFERENCES USERS (Email) ON DELETE CASCADE
);

CREATE TABLE PANEL_MEMBERS (
Panel_ID INT(11) PRIMARY KEY auto_increment,
USN VARCHAR(25),
FOREIGN KEY (USN) REFERENCES STUDENT(USN)
);

ALTER TABLE GUIDE DROP FOREIGN KEY guide_ibfk_3;
ALTER TABLE GUIDE DROP COLUMN DIARY_ID;
DROP TABLE IF EXISTS DELIVERABLE_PROJECT;
CREATE TABLE DELIVERABLE_PROJECT (
Project_ID INT PRIMARY KEY AUTO_INCREMENT,
Project_Title VARCHAR(50) UNIQUE,
Late_Submission BOOLEAN,
Project_Objective VARCHAR(150),
Project_Outcome VARCHAR(150),
Project_Domain VARCHAR(100),
-- Submission varbinary(100),
Panel_ID INT (11),
USN VARCHAR(25),
FOREIGN KEY (Panel_ID) REFERENCES PANEL_MEMBERS(Panel_ID) ON DELETE SET NULL,
FOREIGN KEY (USN) REFERENCES STUDENT(USN)
);

DROP TABLE IF EXISTS DIARY;
CREATE TABLE DIARY (
ID INT(11) PRIMARY KEY AUTO_INCREMENT,
DATE DATE,
COMMENTS VARCHAR(100),
WORK_DONE VARCHAR(100),
USN VARCHAR(25),
FOREIGN KEY (USN) REFERENCES STUDENT(USN) ON DELETE CASCADE
);

DROP TABLE IF EXISTS GUIDE;
CREATE TABLE GUIDE (
Guide_ID VARCHAR(25) PRIMARY KEY,
First_Name VARCHAR(25),
Middle_Name VARCHAR(25),
Last_Name VARCHAR(25),
Email VARCHAR(100) NOT NULL UNIQUE,
Phone_No VARCHAR(15),
Project_ID INT(11),
USN VARCHAR(25),
ID INTEGER(11),
FOREIGN KEY (Project_ID) REFERENCES DELIVERABLE_PROJECT(Project_ID),
FOREIGN KEY (USN) REFERENCES STUDENT(USN),
FOREIGN KEY (ID) REFERENCES DIARY(ID) ON DELETE SET NULL,
FOREIGN KEY (Email) REFERENCES USERS(Email)
);

CREATE TABLE COORDINATOR (
Department_Name VARCHAR(25) PRIMARY KEY,
Panel_ID INT(11),
ID VARCHAR(25),
USN VARCHAR(25),
Email VARCHAR(25),
FOREIGN KEY (Email) REFERENCES USERS(Email) ON DELETE CASCADE,	
FOREIGN KEY (ID) REFERENCES GUIDE(Guide_ID) ON DELETE SET NULL,
FOREIGN KEY (USN) REFERENCES STUDENT(USN),
FOREIGN KEY (Panel_ID) REFERENCES PANEL_MEMBERS(Panel_ID)
);


CREATE TABLE INTERNSHIP_GUIDE (
Intern_ID INT(11) auto_increment,
FIRST_NAME VARCHAR(25),
MIDDLE_NAME VARCHAR(25),
LAST_NAME VARCHAR(25),
COMPANY VARCHAR(25),
DOJ DATE,
FOREIGN KEY (Intern_ID) REFERENCES PANEL_MEMBERS(Panel_ID)
);

CREATE TABLE GUIDE_DOMAIN (
ID VARCHAR(25),
DOMAIN VARCHAR(25),
FOREIGN KEY (ID) REFERENCES GUIDE(GUIDE_ID) ON DELETE CASCADE,
PRIMARY KEY(ID)
);

CREATE TABLE GUIDE_ALLOT (
Panel_ID INT(11),
ID VARCHAR(25),
FOREIGN KEY (Panel_ID) REFERENCES PANEL_MEMBERS(Panel_ID) ON DELETE CASCADE,
FOREIGN KEY (ID) REFERENCES GUIDE(Guide_ID),
PRIMARY KEY (Panel_ID,ID)
);

UPDATE USERS SET PASSWORD = 'admin' WHERE EMAIL = 'ise2020@rvce.edu.in';
INSERT INTO USERS VALUES
('santoshv.is20@rvce.edu.in','root'),
('pritishraj.is20@rvce.edu.in','root2'),
('pulkitgarg.is20@rvce.edu.in','root3'),
('shankartejasvi.is20@rvce.edu.in','cust045'),
('anushkajindal.is20@rvce.edu.in','cust006');

INSERT INTO STUDENT VALUES
  ('1RV20IS043','SANTHOSH','','Vishwanathan','santoshv.is20@rvce.edu.in',9832784529),
  ('1RV20IS035','PRITISH','','RAJ','pritishraj.is20@rvce.edu.in',9472682396),
('1RV20IS036','PULKIT','','GARG','pulkitgarg.is20@rvce.edu.in',6397735901),
  ('1RV20IS045','SHANKAR','','TEJASVI','shankartejasvi.is20@rvce.edu.in',9832784529),
  ('1RV20IS006','ANUSHKA','','JINDAL','anushkajindal.is20@rvce.edu.in',941302389);
  
INSERT INTO PANEL_MEMBERS (PANEL_ID,USN) VALUES (105,'1RV20IS035');
INSERT INTO PANEL_MEMBERS (PANEL_ID,USN) VALUES (100,'1RV20IS043');
INSERT INTO PANEL_MEMBERS (PANEL_ID,USN) VALUES (104,'1RV20IS035');
INSERT INTO PANEL_MEMBERS (PANEL_ID,USN) VALUES (105,'1RV20IS035');



INSERT INTO DELIVERABLE_PROJECT (Project_ID,Project_Title,Late_Submission,Project_Objective,
Project_Outcome,Project_Domain,Panel_ID,USN) VALUES 
('1006','Department Project Management System',TRUE,'Games','App','DBMS','100','1RV20IS043'),
('1003','Diabetes Prediction',FALSE,'To predict diabetes in patients','Website','DBMS','103','1RV20IS045'),
('1004','Alzheimers Prediction',TRUE,'To predict Alzheimers','Website','AIML','104','1RV20IS006'),
('1005','Department Project',FALSE,'Chat App','Website','DBMS','102','1RV20IS036');


INSERT INTO USERS VALUES
('amit@rvce.edu.in','123232'),
('amit21@rvce.edu.in','32811'),
('amit22@rvce.edu.in','443943'),
('amit23@rvce.edu.in','4439433'),
('ami323t@rvce.edu.in','443923');

INSERT INTO USERS VALUES ('ise2020@rvce.edu.in','root1233');

INSERT INTO GUIDE (Guide_ID,First_Name,Middle_Name,Last_Name,Email,Phone_No,Project_ID,USN,ID) VALUES
('1201','Amit','M','Agarwal','amit@rvce.edu.in',4890239881,1003,'1RV20IS035',10003),
('1202','Samit','M','Agarwal','amit21@rvce.edu.in',4890267981,1004,'1RV20IS035',10004),
('1203',',Mamit','M','Agarwal','amit22@rvce.edu.in',489023981,1005,'1RV20IS035',10005),
('1204','Kamit','S','Agarwal','amit23@rvce.edu.in',4890234481,1006,'1RV20IS035',10006);

INSERT INTO COORDINATOR (DEPARTMENT_NAME,PANEL_ID,ID,USN,EMAIL) VALUES
('ISE','100','1201','1RV20IS043','ise2020@rvce.edu.in');


INSERT INTO GUIDE_DOMAIN(ID,DOMAIN) VALUES
('1201','AIML'),
('1202','NLP'),
('1203','CNN'),
('1204','WSN');

INSERT INTO GUIDE_ALLOT(Panel_ID,ID) VALUES
('100','1201'),
('103','1202'),
('104','1203'),
('105','1204');

INSERT INTO INTERNSHIP_GUIDE(INTERN_ID,FIRST_NAME,MIDDLE_NAME,LAST_NAME,COMPANY,DOJ) VALUES
('100','RAM','','KUMAR','ADOBE','2001-02-02'),
('103','RAMA','','KUMARI','MICROSOFT','2007-12-02'),
('102','RAJ','','KUMAR','GOOGLE','2004-12-02'),
('104','HARSH','','AGRAWAL','UIPATH','2002-12-02');

alter table PHASE_ALLOT ADD late_submission INTEGER;

UPDATE PHASE_ALLOT SET PHASE_NO = 2 WHERE PHASE_ID = 1304;

UPDATE PHASE_ALLOT SET LATE_SUBMISSION = 0 WHERE PROJECT_ID IS NOT NULL;

CREATE TABLE PANEL_ALLOT (
ALLOT_NUM INTEGER PRIMARY KEY AUTO_INCREMENT,
GUIDE_ID VARCHAR(25),
PANEL_ID INTEGER,
FOREIGN KEY (GUIDE_ID) REFERENCES GUIDE(GUIDE_ID),
FOREIGN KEY (PANEL_ID) REFERENCES PANEL_MEMBERS(PANEL_ID)
);

-- SELECT D.PROJECT_TITLE,D.PROJECT_DOMAIN,G.FIRST_NAME,G.LAST_NAME FROM DELIVERABLE_PROJECT AS D,STUDENT AS S,USERS AS U,PANEL_ALLOT AS P,GUIDE AS G WHERE D.USN = S.USN AND S.EMAIL = U.EMAIL AND D.PANEL_ID = P.PANEL_ID AND G.GUIDE_ID = P.GUIDE_ID AND U.EMAIL = 'santoshv.is20@rvce.edu.in';
INSERT INTO PANEL_ALLOT (Guide_ID,Panel_ID) VALUES ('1201',100), ('1202',104), ('1203',102), ('1204',103);

UPDATE GUIDE SET USN = '1RV20IS045' WHERE GUIDE_ID = '1201';
UPDATE GUIDE SET USN = '1RV20IS043' WHERE GUIDE_ID = '1204';
UPDATE GUIDE SET USN = '1RV20IS036' WHERE GUIDE_ID = '1203';
UPDATE GUIDE SET USN = '1RV20IS006' WHERE GUIDE_ID = '1202';


ALTER TABLE PHASE_ALLOT MODIFY LATE_SUBMISSION VARCHAR(25);

UPDATE PHASE_ALLOT SET LATE_SUBMISSION = "LATE" WHERE PHASE_ID = 1301;
UPDATE PHASE_ALLOT SET LATE_SUBMISSION = "LATE" WHERE PHASE_ID = 1302;

ALTER TABLE COORDINATOR DROP FOREIGN KEY coordinator_ibfk_4;
ALTER TABLE COORDINATOR DROP PANEL_ID;
ALTER TABLE COORDINATOR DROP FOREIGN KEY coordinator_ibfk_2;
ALTER TABLE COORDINATOR DROP ID;
ALTER TABLE COORDINATOR DROP FOREIGN KEY coordinator_ibfk_3;
ALTER TABLE COORDINATOR DROP USN;

UPDATE STUDENT SET FIRST_NAME = 'SANTOSH',PHONE_NO = '941302389' WHERE USN = '1RV20IS043';

CREATE TABLE STUDENT_SUB (
SUBMISSION_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
USN VARCHAR(25),
PHASE_ID INTEGER,
PROJECT_ID INTEGER,
SUBMITTED_AT DATETIME,
SUBMISSION_STATUS VARCHAR(25),
FOREIGN KEY (USN) REFERENCES STUDENT(USN) ON DELETE CASCADE,
FOREIGN KEY (PHASE_ID) REFERENCES PHASE_ALLOT(PHASE_ID) ON DELETE CASCADE,
FOREIGN KEY (PROJECT_ID) REFERENCES DELIVERABLE_PROJECT(PROJECT_ID)
);


CREATE TABLE SCHEDULE (
PHASE_NO INTEGER PRIMARY KEY,
PHASE_DESC INTEGER,
DUE_DATE DATE
);

ALTER TABLE SCHEDULE
MODIFY PHASE_DESC VARCHAR(100);

ALTER TABLE STUDENT_SUB
ADD FILE_SUBMIT VARCHAR(100);

INSERT INTO SCHEDULE (PHASE_NO,PHASE_DESC,DUE_DATE) VALUES
(1,'SYNOPSIS','2023-02-08'),
(2,'SRS','2023-02-13');

SELECT * FROM DIARY;
SELECT * FROM DELIVERABLE_PROJECT;

CREATE TABLE FILE_SUB (
SUB_ID INTEGER auto_increment PRIMARY KEY,
USN VARCHAR(25),
PHASE_NO INTEGER,
FILE VARCHAR(100) NOT NULL
);

ALTER TABLE PHASE_ALLOT
ADD FOREIGN KEY (PHASE_NO) REFERENCES SCHEDULE(PHASE_NO);

INSERT INTO PHASE_ALLOT VALUES (10032,1003,2,'2023-02-15');

UPDATE PHASE_ALLOT SET PHASE_ID = 10031 WHERE PHASE_ID = 1303;
UPDATE PHASE_ALLOT SET PHASE_ID = 10042 WHERE PHASE_ID = 1304;

UPDATE FILE_SUB SET SUB_ID = 1303 WHERE SUB_ID = 100;

INSERT INTO SCHEDULE (PHASE_NO,PHASE_DESC,DUE_DATE) VALUES (4,'DESIGN AND IMPLEMENTATION','2023-03-19'),(5,'SECURITY AND VALIDATION','2023-02-20'),(6,'MIDTERM REPORT','2023-03-01'),(7,'FINAL_DEMO','2023-03-10');

UPDATE FILE_SUB SET SUB_ID = 10031 WHERE SUB_ID = 1303;

ALTER TABLE FILE_SUB
ADD FOREIGN KEY (SUB_ID) REFERENCES PHASE_ALLOT(PHASE_ID);

DESCRIBE FILE_SUB;

CREATE TABLE TRANSACTIONS (
TRANSACTION_ID INTEGER auto_increment PRIMARY KEY,
SUB_ID INTEGER,
SUBMITTED_AT DATE,
SUB_STATUS VARCHAR(25),
FOREIGN KEY (SUB_ID) REFERENCES PHASE_ALLOT(PHASE_ID)
);

ALTER TABLE DELIVERABLE_PROJECT DROP COLUMN LATE_SUBMISSION;

INSERT INTO TRANSACTIONS VALUES (10000,10031,'2023-02-13','LATE');
UPDATE TRANSACTIONS SET TRANSACTION_ID = 11000 WHERE TRANSACTION_ID = 10000;

ALTER TABLE PHASE_ALLOT DROP COLUMN DUE_DATE;
ALTER TABLE PHASE_ALLOT DROP COLUMN LATE_SUBMISSION;

INSERT INTO PHASE_ALLOT (PHASE_ID,PROJECT_ID,PHASE_NO) VALUES (10032,1003,2),(10041,1004,1),(10051,1005,1),(10052,1005,2);

DELETE FROM FILE_SUB WHERE SUB_ID = 10031;

INSERT INTO TRANSACTIONS (TRANSACTION_ID,SUB_ID,SUBMITTED_AT,SUB_STATUS) VALUES (11001,10032,'2023-02-15',"LATE"),(11002,10041,'2023-02-15',"LATE"),(11003,10051,'2023-02-15','ONTIME');
UPDATE TRANSACTIONS SET SUB_STATUS = "ONTIME" WHERE TRANSACTION_ID = 11003;

-- SELECT F.SUB_ID,F.USN,ST.FIRST_NAME,ST.LAST_NAME,F.PHASE_NO,SC.PHASE_DESC,T.SUB_STATUS FROM FILE_SUB AS F,STUDENT AS ST,TRANSACTIONS AS T,SCHEDULE AS SC,GUIDE AS G WHERE F.USN = ST.USN AND F.PHASE_NO = SC.PHASE_NO AND T.SUB_ID = F.SUB_ID AND G.USN = ST.USN AND G.EMAIL = 'amit@rvce.edu.in';

CREATE TABLE EVALUATE_RESULT (
SUB_ID INTEGER PRIMARY KEY,
USN VARCHAR(25),
RUBRIC_1_MARKS INTEGER,
RUBRIC_2_MARKS INTEGER,
RUBRIC_3_MARKS INTEGER,
FOREIGN KEY (SUB_ID) REFERENCES FILE_SUB(SUB_ID),
FOREIGN KEY (USN) REFERENCES STUDENT(USN)
);

-- DIFFERENT FILE
UPDATE DELIVERABLE_PROJECT SET Project_Title = "Medical Chatbot" WHERE Project_ID = 1005;

UPDATE GUIDE SET USN = '1RV20IS045' WHERE GUIDE_ID = '1201';
UPDATE GUIDE SET USN = '1RV20IS043' WHERE GUIDE_ID = '1204';
UPDATE GUIDE SET USN = '1RV20IS036' WHERE GUIDE_ID = '1203';
UPDATE GUIDE SET USN = '1RV20IS006' WHERE GUIDE_ID = '1202';

CREATE TABLE PANEL_ALLOT (
ALLOT_NUM INTEGER PRIMARY KEY AUTO_INCREMENT,
GUIDE_ID VARCHAR(25),
PANEL_ID INTEGER,
FOREIGN KEY (GUIDE_ID) REFERENCES GUIDE(GUIDE_ID),
FOREIGN KEY (PANEL_ID) REFERENCES PANEL_MEMBERS(PANEL_ID)
);

INSERT INTO PANEL_ALLOT (Guide_ID,Panel_ID) VALUES ('1201',100), ('1202',104), ('1203',102), ('1204',103);

CREATE TABLE PHASE_ALLOT (
phase_ID INTEGER PRIMARY KEY auto_increment,
Project_ID INTEGER,
phase_no INTEGER,
due_date DATE,
FOREIGN KEY (Project_ID) REFERENCES DELIVERABLE_PROJECT(Project_ID)
);

INSERT INTO PHASE_ALLOT VALUES (1203,1003,1,20222-09-03);
INSERT INTO PHASE_ALLOT VALUES (1204,1004,1,20222-10-04);
INSERT INTO PHASE_ALLOT VALUES (1205,1005,0,20222-10-23);
INSERT INTO PHASE_ALLOT VALUES (1206,1006,0,20222-09-03);


UPDATE PHASE_ALLOT SET Phase_ID = 1303 WHERE Phase_ID = 1203;
UPDATE PHASE_ALLOT SET Phase_ID = 1304 WHERE Phase_ID = 1204;

UPDATE PHASE_ALLOT SET LATE_SUBMISSION = "LATE" WHERE PHASE_ID = 1301;
UPDATE PHASE_ALLOT SET LATE_SUBMISSION = "LATE" WHERE PHASE_ID = 1302;

#Update as of 01-02-2023

ALTER TABLE GUIDE RENAME COLUMN ID TO DIARY_ID;

ALTER TABLE COORDINATOR DROP FOREIGN KEY coordinator_ibfk_4;
ALTER TABLE COORDINATOR DROP PANEL_ID;
ALTER TABLE COORDINATOR DROP FOREIGN KEY coordinator_ibfk_2;
ALTER TABLE COORDINATOR DROP ID;
ALTER TABLE COORDINATOR DROP FOREIGN KEY coordinator_ibfk_3;
ALTER TABLE COORDINATOR DROP USN;
ALTER TABLE GUIDE RENAME COLUMN ID TO DIARY_ID;

ALTER TABLE STUDENT_SUB DROP FOREIGN KEY student_sub_ibfk_2;

ALTER TABLE STUDENT_SUB
DROP COLUMN PHASE_ID;

ALTER TABLE STUDENT_SUB
ADD PHASE_NO INTEGER;

ALTER TABLE STUDENT_SUB DROP COLUMN SUBMISSION_STATUS;

ALTER TABLE STUDENT_SUB
MODIFY FILE_SUBMIT BLOB;

UPDATE PHASE_ALLOT SET DUE_DATE = '2023-02-10' WHERE PHASE_ID = 1303;
UPDATE PHASE_ALLOT SET DUE_DATE = '2023-02-15' WHERE PHASE_ID = 1304;
-- CHECKPOINT - SQL FILE DONE AS OF 14TH FEB 2023 - BEFORE LAB EXAM BELOW
ALTER TABLE STUDENT_SUB DROP FOREIGN KEY student_sub_ibfk_2;
ALTER TABLE STUDENT_SUB
DROP COLUMN PHASE_ID;

ALTER TABLE STUDENT_SUB
ADD PHASE_NO INTEGER;

ALTER TABLE STUDENT_SUB DROP COLUMN SUBMISSION_STATUS;

ALTER TABLE STUDENT_SUB
MODIFY FILE_SUBMIT BLOB;

UPDATE PHASE_ALLOT SET DUE_DATE = '2023-02-10' WHERE PHASE_ID = 1303;
UPDATE PHASE_ALLOT SET DUE_DATE = '2023-02-15' WHERE PHASE_ID = 1304;

CREATE TABLE STUDENT_SUB (
SUBMISSION_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
USN VARCHAR(25),
PHASE_ID INTEGER,
PROJECT_ID INTEGER,
SUBMITTED_AT DATETIME,
SUBMISSION_STATUS VARCHAR(25),
FOREIGN KEY (USN) REFERENCES STUDENT(USN) ON DELETE CASCADE,
FOREIGN KEY (PHASE_ID) REFERENCES PHASE_ALLOT(PHASE_ID) ON DELETE CASCADE,
FOREIGN KEY (PROJECT_ID) REFERENCES DELIVERABLE_PROJECT(PROJECT_ID)
);

CREATE TABLE SCHEDULE (
PHASE_NO INTEGER PRIMARY KEY,
PHASE_DESC INTEGER,
DUE_DATE DATE
);

SHOW TABLES;

ALTER TABLE SCHEDULE
MODIFY PHASE_DESC VARCHAR(100);

ALTER TABLE STUDENT_SUB
ADD FILE_SUBMIT VARCHAR(100);


INSERT INTO SCHEDULE (PHASE_NO,PHASE_DESC,DUE_DATE) VALUES
(1,'SYNOPSIS','2023-02-08'),
(2,'SRS','2023-02-13');


CREATE TABLE FILE_SUB (
SUB_ID INTEGER auto_increment PRIMARY KEY,
USN VARCHAR(25),
PHASE_NO INTEGER,
FILE VARCHAR(100) NOT NULL
);

ALTER TABLE PHASE_ALLOT
ADD FOREIGN KEY (PHASE_NO) REFERENCES SCHEDULE(PHASE_NO);

INSERT INTO PHASE_ALLOT VALUES (10032,1003,2,'2023-02-15');

UPDATE PHASE_ALLOT SET PHASE_ID = 10031 WHERE PHASE_ID = 1303;
UPDATE PHASE_ALLOT SET PHASE_ID = 10042 WHERE PHASE_ID = 1304;

UPDATE FILE_SUB SET SUB_ID = 1303 WHERE SUB_ID = 100;

INSERT INTO SCHEDULE (PHASE_NO,PHASE_DESC,DUE_DATE) VALUES (4,'DESIGN AND IMPLEMENTATION','2023-03-19'),(5,'SECURITY AND VALIDATION','2023-02-20'),(6,'MIDTERM REPORT','2023-03-01'),(7,'FINAL_DEMO','2023-03-10');

UPDATE FILE_SUB SET SUB_ID = 10031 WHERE SUB_ID = 1303;

ALTER TABLE FILE_SUB
ADD FOREIGN KEY (SUB_ID) REFERENCES PHASE_ALLOT(PHASE_ID);


CREATE TABLE TRANSACTIONS (
TRANSACTION_ID INTEGER auto_increment PRIMARY KEY,
SUB_ID INTEGER,
SUBMITTED_AT DATE,
SUB_STATUS VARCHAR(25),
FOREIGN KEY (SUB_ID) REFERENCES PHASE_ALLOT(PHASE_ID)
);

INSERT INTO TRANSACTIONS VALUES (10000,10031,'2023-02-13','LATE');
UPDATE TRANSACTIONS SET TRANSACTION_ID = 11000 WHERE TRANSACTION_ID = 10000;

ALTER TABLE PHASE_ALLOT DROP COLUMN DUE_DATE;
ALTER TABLE PHASE_ALLOT DROP COLUMN LATE_SUBMISSION;

INSERT INTO PHASE_ALLOT (PHASE_ID,PROJECT_ID,PHASE_NO) VALUES (10032,1003,2),(10041,1004,1),(10051,1005,1),(10052,1005,2);
ALTER TABLE GUIDE RENAME COLUMN ID TO DIARY_ID;

USE DEPT_PROJECT;
UPDATE DELIVERABLE_PROJECT SET Project_Title = "Medical Chatbot" WHERE Project_ID = 1005;

CREATE TABLE PHASE_ALLOT (
phase_ID INTEGER PRIMARY KEY auto_increment,
Project_ID INTEGER,
phase_no INTEGER,
due_date DATE,
FOREIGN KEY (Project_ID) REFERENCES DELIVERABLE_PROJECT(Project_ID)
);

INSERT INTO PHASE_ALLOT VALUES (1203,1003,1,20222-09-03);
INSERT INTO PHASE_ALLOT VALUES (1204,1004,1,20222-10-04);
INSERT INTO PHASE_ALLOT VALUES (1205,1005,0,20222-10-23);
INSERT INTO PHASE_ALLOT VALUES (1206,1006,0,20222-09-03);

UPDATE PHASE_ALLOT SET Phase_ID = 1303 WHERE Phase_ID = 1203;
UPDATE PHASE_ALLOT SET Phase_ID = 1304 WHERE Phase_ID = 1204;

INSERT INTO FILE_SUB VALUES (10041,'1RV20IS006',1,'dept_project/static/DEPARTMENT_PROJECT_MANAGEMENT_SYSTEM/upload/economics_el_script.docx');


set foreign_key_checks = 0;
alter table FILE_SUB change column SUB_ID SUB_ID INT NOT NULL;
set foreign_key_checks = 1;

-- CHECKPOINT - 1 - TILL HERE YOU ALREADY HAVE THE SQL FILES - NEW CHANGES DONE FROM HERE ONWARDS
INSERT INTO TRANSACTIONS VALUES  (11004,10042,'2023-03-21','ONTIME');
ALTER TABLE EVALUATE_RESULT 
ADD GUIDE_NO VARCHAR(25);
UPDATE EVALUATE_RESULT SET GUIDE_NO = '1201' WHERE USN = '1RV20IS045';
INSERT INTO PHASE_ALLOT VALUES ('10061','1006','1');
DELETE FROM FILE_SUB WHERE SUB_ID = '10061';
DELETE FROM FILE_SUB WHERE SUB_ID = '10061';
INSERT INTO EVALUATE_RESULT VALUES(10042,'1RV20IS045',10,4,4,'');
INSERT INTO EVALUATE_RESULT VALUES (10042,'1RV20IS045',10,4,4,'1201');
DELETE FROM EVALUATE_RESULT WHERE SUB_ID = '10061';
USE DEPT_PROJECT;

ALTER TABLE EVALUATE_RESULT ADD COLUMN RESULT INTEGER; 

-- SELECT F.SUB_ID,F.USN,ST.FIRST_NAME,ST.LAST_NAME,F.PHASE_NO,SC.PHASE_DESC,T.SUB_STATUS FROM FILE_SUB AS F,STUDENT AS ST,TRANSACTIONS AS T,SCHEDULE AS SC,GUIDE AS G WHERE F.USN = ST.USN AND F.PHASE_NO = SC.PHASE_NO AND T.SUB_ID = F.SUB_ID AND G.USN = ST.USN AND ST.EMAIL = 'shankartejasvi.is20@rvce.edu.in';
-- SELECT F.SUB_ID,F.PHASE_NO,SC.PHASE_DESC,T.SUB_STATUS,E.RESULT FROM FILE_SUB AS F,SCHEDULE AS SC,TRANSACTIONS AS T,EVALUATE_RESULT AS E,STUDENT AS ST WHERE F.USN = ST.USN AND F.PHASE_NO = SC.PHASE_NO AND T.SUB_ID = F.SUB_ID AND E.SUB_ID = F.SUB_ID AND ST.EMAIL = 'shankartejasvi.is20@rvce.edu.in'; 
-- SELECT
--   RUBRIC_1_MARKS + RUBRIC_2_MARKS + RUBRIC_3_MARKS AS "Total"
-- FROM EVALUATE_RESULT;
UPDATE EVALUATE_RESULT 
SET RESULT = RUBRIC_1_MARKS + RUBRIC_2_MARKS + RUBRIC_3_MARKS
WHERE SUB_ID = '10031' OR SUB_ID = '10042' OR SUB_ID = '10061';

ALTER TABLE FILE_SUB ADD COLUMN EVAL BOOLEAN;

UPDATE FILE_SUB
SET EVAL = TRUE 
WHERE SUB_ID = '10042' OR SUB_ID = '10061';
UPDATE FILE_SUB
SET EVAL = FALSE 
WHERE NOT SUB_ID = '10042' AND NOT SUB_ID = '10061';

-- SELECT F.SUB_ID,S.PHASE_NO,S.PHASE_DESC,T.SUBMITTED_AT FROM SCHEDULE AS S,TRANSACTIONS AS T,FILE_SUB AS F,PHASE_ALLOT AS PA, DELIVERABLE_PROJECT AS D WHERE S.PHASE_NO = F.PHASE_NO AND T.SUB_ID = PA.PHASE_ID AND F.USN = D.USN AND T.SUB_ID = F.SUB_ID AND F.EVAL = FALSE;

USE DEPT_PROJECT;
-- SELECT 
--   TABLE_NAME,COLUMN_NAME,CONSTRAINT_NAME, REFERENCED_TABLE_NAME,REFERENCED_COLUMN_NAME
-- FROM
--   INFORMATION_SCHEMA.KEY_COLUMN_USAGE
-- WHERE
--   REFERENCED_TABLE_SCHEMA = 'DEPT_PROJECT' AND
--   REFERENCED_TABLE_NAME = 'GUIDE';
  
ALTER TABLE DELIVERABLE_PROJECT
DROP FOREIGN KEY deliverable_project_ibfk_2;

ALTER TABLE DELIVERABLE_PROJECT
ADD CONSTRAINT fk_student_project
FOREIGN KEY (USN) REFERENCES STUDENT(USN) ON DELETE CASCADE;

ALTER TABLE DELIVERABLE_PROJECT
DROP FOREIGN KEY fk_student_project;

ALTER TABLE DELIVERABLE_PROJECT
ADD CONSTRAINT fk_student_project
FOREIGN KEY (USN) REFERENCES STUDENT(USN) ON DELETE SET NULL;

ALTER TABLE guide
DROP foreign key guide_ibfk_1;

ALTER TABLE guide
ADD CONSTRAINT fk_guide_project
FOREIGN KEY (PROJECT_ID) REFERENCES deliverable_project(PROJECT_ID) ON DELETE SET NULL;

ALTER TABLE GUIDE
DROP FOREIGN KEY guide_ibfk_2;

ALTER TABLE guide
ADD CONSTRAINT fk_guide_usn
FOREIGN KEY (USN) REFERENCES STUDENT(USN) ON DELETE SET NULL;

ALTER TABLE PANEL_MEMBERS
DROP foreign key panel_members_ibfk_1;

ALTER TABLE PANEL_MEMBERS
ADD CONSTRAINT fk_panel_usn
FOREIGN KEY (USN) REFERENCES STUDENT(USN);

ALTER TABLE PANEL_MEMBERS
DROP FOREIGN KEY fk_panel_usn;

ALTER TABLE PANEL_MEMBERS 
ADD CONSTRAINT fk_panel_usn_1
FOREIGN KEY (USN) REFERENCES STUDENT(USN) ON DELETE SET NULL;
